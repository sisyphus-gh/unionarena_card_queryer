<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>UA查卡器</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>



    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var elems = document.querySelectorAll('.materialboxed');
            var instances = M.Materialbox.init(elems);
        });

        var datas;
        var url = "./data_cn.json"
        var request = new XMLHttpRequest();
        request.open("get", url); /*设置请求方法与路径*/
        request.send(null); /*不发送数据到服务器*/
        request.onload = function () { /*XHR对象获取到返回信息后执行*/
            if (request.status == 200) { /*返回状态为200，即为数据获取成功*/
                datas = JSON.parse(request.responseText);
                search();
            }
        }

        function clickCard(e) {
            var id = e.getAttribute("id");

            var data;
            for (var i = 0; i < datas.length; i++) {
                data = datas[i];
                if (data.id == id) {
                    break;
                }
            }

            var cardInfoDiv = document.getElementById("cardInfoArea");
            while (cardInfoDiv.hasChildNodes()) {
                cardInfoDiv.removeChild(cardInfoDiv.firstChild);
            }

            cardInfoDiv.innerHTML =
                `<div class="card-image col s4">
                    <img class="materialboxed" src="./card/${data.imageFileName}" >
                 </div>
                    <div class=" col s8">
                <p style="font-size:1.5rem;">${data.cardNumData}&nbsp;&nbsp;&nbsp;&nbsp;${data.rareData}</p>
                    <p style="font-size:1.2rem;">中文卡名: ${data.cardCnName}</p>
                <p style="font-size:1.2rem;">日文卡名:${data.cardName}</p>
                <p style="font-size:1.2rem;">特征：${data.attributeCnData}</p>
            </div>
                <div class="card-tabs">
                    <ul class="tabs tabs-fixed-width">
                    <li class="tab"><a href="#test4">效果</a></li>
                    <li class="tab"><a href="#test5">触发效果</a></li>
                    </ul>
                </div>
                <div class="card-content grey lighten-4">
                <div id="test4">${data.effectCnData}</div>
                <div id="test5">${data.triggerCnData}</div>
            
           `;




            document.querySelector('#test4').innerText = data.effectCnData;

            M.Materialbox.init(document.querySelectorAll('.materialboxed'));
            M.Tabs.init(document.querySelectorAll('.tabs'), { "swipeable": true });
        }

        function search() {
            form = document.getElementById("search");
            var effectData = form.querySelector('[name="effectData"]').value;
            var ipData = form.querySelector('[name="ipData"]').value;
            var cardCnName = form.querySelector('[name="cardCnName"]').value;
            var cardName = form.querySelector('[name="cardName"]').value;
            var cardPackData = form.querySelector('[name="cardPackData"]').value;
            var colorData = form.querySelector('[name="colorData"]').value;
            var needEnergyData = form.querySelector('[name="needEnergyData"]').value;
            var cardNumData = form.querySelector('[name="cardNumData"]').value;
            var rareData = form.querySelector('[name="rareData"]').value;
            var parallelFlag = form.querySelector('[name="parallelFlag"]').value;
            var triggerCnData = form.querySelector('[name="triggerCnData"]').value;
            var attributeCnData = form.querySelector('[name="attributeCnData"]').value;


            var cardDiv = document.getElementById("cardListArea");
            var cardDivHtml = "";
            var count = 0;
            for (var i = 0; i < datas.length; i++) {
                var data = datas[i];
                if (effectData != "" && !data.effectCnData.includes(effectData)) {
                    continue;
                }
                if (cardNumData != "" && !data.cardNumData.includes(cardNumData)) {
                    continue;
                }
                if (cardCnName != "" && !data.cardCnName.includes(cardCnName)) {
                    continue;
                }
                if (cardName != "" && !data.cardName.includes(cardName)) {
                    continue;
                }
                if (ipData != "" && data.ipData != ipData) {
                    continue;
                }
                if (cardPackData != "" && data.cardPackData != cardPackData) {
                    continue;
                }
                if (colorData != "" && !data.needEnergyData.includes(colorData)) {
                    continue;
                }
                if (needEnergyData != "" && !data.needEnergyData.endsWith(needEnergyData)) {
                    continue;
                }
                if (parallelFlag != "" && data.rareData.includes("★")) {
                    continue;
                }
                if (rareData != "" && data.rareData != rareData) {
                    continue;
                }
                if (triggerCnData != "" && !data.triggerCnData.startsWith(triggerCnData)) {
                    continue;
                }
                if (attributeCnData != "" && !data.attributeCnData.includes(attributeCnData)) {
                    continue;
                }

                cardDivHtml = cardDivHtml +
                    `<div class="cardImageBox col s2">
                        <img onclick="clickCard(this);" id="${data.id}" src="./card/${data.imageFileName}" width="100%" class="col s12"/>
                        <p class="center-align" style="font-size: 1.25rem;font-weight: bolder; margin: 0px;">${data.cardNumData}</p>
                        <p class="center-align" style="font-size: 1.20rem; margin: 0px;">${data.cardCnName}</p>
                    </div>`;
                count++;
            }
            cardDiv.innerHTML = cardDivHtml;

            document.getElementById("searchCount").innerHTML = count;
        }
    </script>
    <style>


        /* #cardListArea {
            display: flex;
            flex-wrap: wrap;
            padding: 0 0 0 10px;
        } */

        #cardInfoArea {
            height: calc(100vh - 30px);
        }
    </style>
</head>

<body class="row" style="background-color: #ffaaa5;">
    <div class="col s8">
        <div class="card" style="background-color: #ffd3b6;">
            <form id="search" style="width: 100%; " class="row"> 
                <div class="col s3"> 卡片编号 ：<input type="text" name="cardNumData" class="browser-default" /> </div>
                <div class="col s3"> 中文卡名 ：<input type="text" name="cardCnName" class="browser-default" /> </div>
                <div class="col s3">  日文卡名 ： <input type="text" name="cardName" class="browser-default" /></div>
                <div class="col s3">  效果 ： <input type="text" name="effectData" class="browser-default" /></div>
                <div class="col s3">  稀有度 ： <select name="rareData" class="browser-default">
                        <option value="">全部</option>
                        <option value="C">C</option>
                        <option value="U">U</option>
                        <option value="R">R</option>
                        <option value="SR">SR</option>
                        <option value="C★">C★</option>
                        <option value="U★">U★</option>
                        <option value="R★">R★</option>
                        <option value="SR★">SR★</option>
                        <option value="SR★★">SR★★</option>
                        <option value="SR★★★">SR★★★</option>
                    </select>
                </div>
                <div class="col s3">  出场作品 ： <select name="ipData" class="browser-default">
                        <option value="">全部</option>
                        <option value="CGH">反叛的鲁路修</option>
                        <option value="JJK">咒术回战</option>
                        <option value="HTR">全职猎人</option>
                        <option value="IMS">偶像大师 闪耀色彩</option>
                        <option value="KMY">鬼灭之刃</option>
                    </select>
                </div>
                <div class="col s3"> 所属商品 ： <select name="cardPackData" class="browser-default">
                        <option value="">全部</option>
                        <option value="UA01BT">反叛的鲁路修 UA01BT</option>
                        <option value="UA01ST">反叛的鲁路修 UA01ST</option>
                        <option value="UA01PB">反叛的鲁路修 UA01PB</option>
                        <option value="UA02BT">咒术回战 UA02BT</option>
                        <option value="UA02ST">咒术回战 UA02ST</option>
                        <option value="UA02PB">咒术回战 UA02PB</option>
                        <option value="UA03BT">全职猎人 UA03BT</option>
                        <option value="UA03ST">全职猎人 UA03ST</option>
                        <option value="UA03PB">全职猎人 UA03PB</option>
                        <option value="UAPR">PR</option>
                    </select>
                </div>
                <div class="col s3">  颜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;色 ： <select name="colorData" class="browser-default">
                        <option value="">全部</option>
                        <option value="紫">紫</option>
                        <option value="緑">绿</option>
                        <option value="赤">红</option>
                        <option value="青">蓝</option>
                        <option value="黄">黄</option>
                    </select>
                </div>
                <div class="col s3"> 所需能量 ： <select name="needEnergyData" class="browser-default">
                        <option value="">全部</option>
                        <option value="-">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="col s3"> 触发效果 ： <select name="triggerCnData" class="browser-default">
                        <option value="">全部</option>
                        <option value="【最终】">最终</option>
                        <option value="【特殊】">特殊</option>
                        <option value="【色彩】">色彩</option>
                        <option value="【获得】">获得</option>
                        <option value="【抽卡】">抽卡</option>
                        <option value="【激活】">激活</option>
                        <option value="【突进】">突进</option>
                    </select>
                </div>
                <div class="col s3"> 特征 ：
                    <select name="attributeCnData" class="browser-default">
                        <option value="">全部</option>
                        <option value="黑色骑士团">黑色骑士团</option>
                        <option value="四圣剑">四圣剑</option>
                        <option value="KMF">KMF</option>
                        <option value="神圣布里塔尼亚帝国">神圣布里塔尼亚帝国</option>
                        <option value="纯血派">纯血派</option>
                        <option value="亲卫队">亲卫队</option>
                        <option value="KGF">KGF</option>
                        <option value="阿什福德学园">阿什福德学园</option>
                        <option value="披萨">披萨</option>
                        <option value="式神">式神</option>
                        <option value="京都校">京都校</option>
                        <option value="咒具">咒具</option>
                        <option value="改造人间">改造人间</option>
                        <option value="咒灵">咒灵</option>
                        <option value="指定口袋">指定口袋</option>
                        <option value="揍敌客家族">揍敌客家族</option>
                        <option value="爆弹魔">爆弹魔</option>
                        <option value="幻影旅团">幻影旅团</option>
                        <option value="Straylight">Straylight</option>
                    </select>


                </div>
                <div class="col s3">  显示异画 ： <select name="parallelFlag" class="browser-default">
                        <option value="no">过滤</option>
                        <option value="">全部</option>
                    </select>
                </div>

                <div class="col s3"> 
                    <button type="button" onclick="search()"
                        class="py-2 px-4 flex justify-center items-center  bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 focus:ring-offset-blue-200 text-white w-full transition ease-in duration-200 text-center text-base font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2  w-12 h-12 rounded-lg ">
                        搜索
                    </button>
                </div>

            </form>
        </div>

        <div class="card"
            style="overflow: hidden;overflow-y: auto;height: calc(100vh - 30px);background-color: #fdffab;">
            <p style="font-size: 2rem; text-align: center;">搜索结果:<span id="searchCount">0</span></p>
            <div id="cardListArea" class="row">
                <!-- <img src="./card/UA01BT_CGH-1-001.png" class="cardImage"> -->
            </div>
        </div>

    </div>

    <div class="row col s4">
        <div id="cardInfoArea" class="col s12 card" style="background-color: #a8e6cf;">
        </div>
    </div>
</body>

</html>