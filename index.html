<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>UA查卡器</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <link rel='stylesheet' type='text/css' media='screen' href='main.css'> -->
    <!-- <script src='main.js'></script> -->


    <script>
        var datas;
        var url = "./data_cn.json"
        var request = new XMLHttpRequest();
        request.open("get", url); /*设置请求方法与路径*/
        request.send(null); /*不发送数据到服务器*/
        request.onload = function () { /*XHR对象获取到返回信息后执行*/
            if (request.status == 200) { /*返回状态为200，即为数据获取成功*/
                datas = JSON.parse(request.responseText);


                search();
            }
        }

        function clickCard(e) {
            var id = e.getAttribute("id");

            var data;
            for (var i = 0; i < datas.length; i++) {
                data = datas[i];
                if (data.id == id) {
                    break;
                }
            }

            var cardInfoDiv = document.getElementById("cardInfoArea");
            cardInfoDiv.innerHTML = `
            <h1>${data.cardNumData}&nbsp;&nbsp;&nbsp;&nbsp;${data.rareData}</h1>
            <h2>中文卡名: ${data.cardCnName}</h2>
            <h2>日文卡名: ${data.cardName}</h2>
            <h2>特征：${data.attributeCnData}</h2>
            <h2>效果: </h2>
            <p>${data.effectCnData}</p>
            <h2>触发效果：</h2>
            <p>${data.triggerCnData}</p>
            <img src="${e.getAttribute("src")}" style="width: 75%">`;

        }

        function search() {
            form = document.getElementById("search");
            var ipData = form.querySelector('[name="ipData"]').value;
            var cardCnName = form.querySelector('[name="cardCnName"]').value;
            var cardName = form.querySelector('[name="cardName"]').value;
            var cardPackData = form.querySelector('[name="cardPackData"]').value;
            var colorData = form.querySelector('[name="colorData"]').value;
            var needEnergyData = form.querySelector('[name="needEnergyData"]').value;
            var cardNumData = form.querySelector('[name="cardNumData"]').value;
            var rareData = form.querySelector('[name="rareData"]').value;
            var parallelFlag = form.querySelector('[name="parallelFlag"]').value;

            var cardDiv = document.getElementById("cardListArea");

            var cardDivHtml = "";
            var count = 0;
            for (var i = 0; i < datas.length; i++) {
                var data = datas[i];

                if (cardCnName != "" && !data.cardCnName.includes(cardCnName)) {
                    continue;
                }
                if (cardName != "" && !data.cardName.includes(cardName)) {
                    continue;
                }
                if (ipData != "" && data.ipData != ipData) {
                    continue;
                }
                if (cardPackData != "" && data.cardPackData != cardPackData) {
                    continue;
                }
                if (colorData != "" && !data.needEnergyData.includes(colorData)) {
                    continue;
                }
                if (needEnergyData != "" && !data.needEnergyData.endsWith(needEnergyData)) {
                    continue;
                }
                if (parallelFlag != "" && data.rareData.includes("★")) {
                    continue;
                }
                if (rareData != "" && data.rareData != rareData) {
                    continue;
                }

                cardDivHtml = cardDivHtml +
                    `<div class="cardImageBox"><img onclick="clickCard(this);" id="${data.id}" src="./card/${data.imageFileName}" class="cardImage"/>
                    <p style="font-size: 16px;font-weight: bolder;">${data.cardNumData}</p>
                    <p style="font-size: 16px;">${data.cardCnName}</p>
                    </div>`;
                count++;
            }
            cardDiv.innerHTML = cardDivHtml;

            document.getElementById("searchCount").innerHTML = count;
        }
    </script>
    <style>
        * {
            margin: 0px;
        }

        .main {
            display: flex;
            flex-wrap: wrap;
            width: 70%;
        }


        .main #search {
            padding-top: 10px;
            padding-left: 13px;
            padding-bottom: 10px;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
        }

        .main #search>div {
            margin-top: 5px;
            width: 320px;
        }

        #cardListArea {
            display: flex;
            flex-wrap: wrap;
            padding: 0 0 0 10px;
        }

        #cardInfoArea {
            position: fixed;
            top: 10px;
            right: 10px;
            border-width: 4px;
            border-style: double;
            width: 30%;
            height: calc(100vh - 30px);
            overflow: hidden;
            overflow-y: auto;
            padding: 0 8px 8px 8px;
        }

        .cardImageBox {
            margin: 0 3px;
        }

        .cardImageBox p {
            text-align: center;
        }


        .cardImage {
            /* width: 19.5% */
            width: 250px;
            margin: 3px auto;
            display: block;
        }
    </style>
</head>

<body>
    <div class="main">
        <div class="searchBox">
            <form id="search" style="width: 100%; ">
                <div> 中文卡名 ：<input type="text" name="cardCnName" /> </div>
                <div> 日文卡名 ： <input type="text" name="cardName" /></div>
                <div> 出场作品 ： <select name="ipData">
                        <option value="">全部</option>
                        <option value="CGH">《CODE GEASS 反叛的鲁路修》</option>
                        <option value="JJK">《咒术回战》</option>
                        <option value="HTR">《全职猎人》</option>
                        <option value="IMS">《偶像大师 闪耀色彩》</option>
                        <option value="KMY">《鬼灭之刃》</option>
                    </select>
                </div>
                <div> 所属商品 ： <select name="cardPackData">
                        <option value="">全部</option>
                        <option value="UA01BT">反叛的鲁路修 UA01BT</option>
                        <option value="UA01ST">反叛的鲁路修 UA01ST</option>
                        <option value="UA01PB">反叛的鲁路修 UA01PB</option>
                        <option value="UA02BT">咒术回战 UA02BT</option>
                        <option value="UA02ST">咒术回战 UA02ST</option>
                        <option value="UA02PB">咒术回战 UA02PB</option>
                        <option value="UA03BT">全职猎人 UA03BT</option>
                        <option value="UA03ST">全职猎人 UA03ST</option>
                        <option value="UA03PB">全职猎人 UA03PB</option>
                        <option value="UAPR">PR</option>
                    </select>
                </div>
                <div> 颜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;色 ： <select name="colorData">
                        <option value="">全部</option>
                        <option value="紫">紫</option>
                        <option value="緑">绿</option>
                        <option value="赤">红</option>
                        <option value="青">蓝</option>
                        <option value="黄">黄</option>
                    </select>
                </div>
                <div>所需能量 ： <select name="needEnergyData">
                        <option value="">全部</option>
                        <option value="-">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>

                <div> 卡片编号 ：<input type="text" name="cardNumData" /> </div>

                <div> 稀有度 ： <select name="rareData">
                        <option value="">全部</option>
                        <option value="C">C</option>
                        <option value="U">U</option>
                        <option value="R">R</option>
                        <option value="SR">SR</option>
                        <option value="SR★">SR★</option>
                        <option value="SR★★">SR★★</option>
                        <option value="SR★★★">SR★★★</option>
                    </select>
                </div>

                <div> 显示异画 ： <select name="parallelFlag">
                        <option value="no">过滤</option>
                        <option value="">全部</option>
                    </select>
                </div>

                <div>
                    <input type="button" value="搜索" onclick="search()" />
                </div>

            </form>
        </div>
        <h1 style="margin-left: 20px;text-align: center;width:100%;">搜索结果:<span id="searchCount">0</span>
            <a target="_blank"
                href="./deck_edit.html?deck=UA01BT/CGH-1-001%0AUA01BT/CGH-1-002%0AUA01BT/CGH-1-003%0AUA01BT/CGH-1-004">点这组卡</a>
        </h1>
        <div id="cardListArea">
            <!-- <img src="./card/UA01BT_CGH-1-001.png" class="cardImage"> -->
        </div>
    </div>
    <div id="cardInfoArea">
    </div>
</body>

</html>